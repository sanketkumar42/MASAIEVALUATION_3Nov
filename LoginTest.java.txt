package com.quantumleap.tests.ui;

import com.quantumleap.core.WebDriverFactory;
import com.quantumleap.pages.LoginPage;
import org.testng.Assert;
import org.testng.annotations.*;

import org.openqa.selenium.WebDriver;

@Listeners(com.quantumleap.core.TestListener.class)
public class LoginTest {
    private WebDriver driver;
    private LoginPage loginPage;

    @BeforeMethod
    public void setUp() {
        driver = WebDriverFactory.getDriver();
        loginPage = new LoginPage(driver);
        loginPage.open();
    }

    @DataProvider(name="login-data")
    public Object[][] loginData() {
        return new Object[][] {
            {"standard_user","secret_sauce","SUCCESS"},
            {"locked_out_user","secret_sauce","LOCKED"},
            {"performance_glitch_user","secret_sauce","SUCCESS"}
        };
    }

    @Test(dataProvider="login-data")
    public void testLoginScenarios(String user, String pass, String expected) {
        loginPage.login(user, pass);
        if ("LOCKED".equals(expected)) {
            String err = loginPage.getErrorMessage();
            Assert.assertTrue(err.contains("locked"), "Expected locked message but got: " + err);
        } else {
            // success means we arrived on products page -> check URL or page elements
            Assert.assertTrue(driver.getCurrentUrl().contains("inventory.html"), "Login failed for " + user);
        }
    }

    @AfterMethod
    public void tearDown() {
        WebDriverFactory.quitDriver();
    }
}
